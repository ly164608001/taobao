<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lxhrainy.myjz.admin.houses.dao.IHousesDetailTrafficDao">
	<sql id="baseColumn">
		T.id,T.housesid,T.modifyuser,T.modifytime,T.bus,T.metro,T.freeway,T.other	
	</sql>
	
	<select id="findListByPage" resultType="HousesDetailTraffic">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid AS "houses.id" 
		FROM 
			houses_detail_traffic T
		<if test="condition!=null">
			<where>
				T.deleted !=1
			</where>
			order by T.ID DESC
			<include refid="Sql.pager" />
		</if>
	</select>
	
	<select id="getCountByCondition" resultType="int">
		SELECT 
			count(*)
		FROM houses_detail_traffic T
		<if test="condition!=null">
			<where>
				T.deleted !=1
			</where>
		</if>
	</select>
	
	<select id="findAllList" resultType="HousesDetailTraffic">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid AS "houses.id" 
		FROM 
			houses_detail_traffic T
		<where>
				T.deleted !=1
		</where>
	</select>
	

	<!--根据ID获取详情  -->
	<select id="getById" resultType="HousesDetailTraffic">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid as "houses.id"
		FROM 
			houses_detail_traffic T
		WHERE 
			id = #{id}
	</select>
	
<!-- 根据ID删除楼盘信息 -->
	<update id="deleteById">
		UPDATE 
			houses_detail_traffic 
		SET 
			deleted=1
		WHERE 
			id = #{id}
	</update>
	
	<!-- 插入楼盘详细信息 -->
	<insert id="insert" >
		<!-- 配置Mysql主键自动增长 -->
		<selectKey resultType="int" keyProperty="id" order="BEFORE">
			SELECT 
				auto_increment AS id 
			FROM 
				information_schema.tables    
    		WHERE 
    			table_name='houses_detail_traffic'
		</selectKey>
		INSERT INTO 
			houses_detail_traffic (
				id,
				housesid,
		       	modifyuser,
		        modifytime, 
		        bus,
		        metro,
		        freeway,
		        other
			)
		VALUES (
	    	#{id},
			#{houses.id},
	       	#{modifyuser},
	        #{modifytime}, 
	        #{bus},
	        #{metro},
	        #{freeway},
	        #{other}
	      )
	</insert>
	
	<!-- 更新楼盘基本信息 -->
	<update id="update">
		UPDATE 
			houses_detail_traffic 
		<set>
			<if test="houses !=null and houses.id !=null and houses.id !=''">
				housesid = #{houses.id},
			</if>
			<if test="modifyuser !=null and modifyuser !=''">
				modifyuser = #{modifyuser},
			</if>
			<if test="modifytime !=null and modifytime !='' ">
				modifytime = #{modifytime},
			</if>
			<if test="bus !=null and bus !=''" >
				bus = #{bus},
			</if>
			<if test="metro !=null and metro !=''">
				metro = #{metro},
			</if>
			<if test="freeway !=null and freeway !=''" >
				freeway = #{freeway},
			</if>
			<if test="other !=null and other !=''" >
				other = #{other},
			</if>
		</set>
		WHERE 
			id = #{id}
	</update>
	
	<!--根据楼盘ID获取houses_detail_traffic详情  -->
	<select id="getTrafficByHousesId" resultType="HousesDetailTraffic">
		SELECT 
			<include refid="baseColumn"></include>
		FROM 
			houses_detail_traffic T
		WHERE 
			housesid = #{housesid}
	</select>	
	
</mapper>