<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lxhrainy.myjz.admin.houses.dao.IHousesBuildingDao">
	<sql id="baseColumn">
		T.id,T.housesid,T.name,T.periodnum,T.isemptyspace,T.allfloors,T.floorheight,T.decoratestateId,T.allhouseholds,
		T.liftnum,T.househlods,T.distribution,T.modifyuser,T.modifytime,T.gatetowards,T.deleted
	</sql>
	<select id="findListByPage" resultType="HousesBuilding">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid as "houses.id" 
		FROM 
			houses_building T
		<if test="condition!=null">
			<where>
				T.deleted !=1
				<if test="condition.model!=null">
					<if test="condition.model.name!=null and condition.model.name!=''">
						AND T.name LIKE '%${condition.model.name}%'
					</if>
				</if>
			</where>
			ORDER BY T.id DESC
			<include refid="Sql.pager" />
		</if>
	</select>
	
	<select id="getCountByCondition" resultType="int">
		SELECT 
			count(*)
		FROM houses_building T
		<if test="condition!=null">
			<where>
				T.deleted !=1
				<if test="condition.model!=null">
					<if test="condition.model.name!=null and condition.model.name!=''">
						AND T.name LIKE '%${condition.model.name}%'
					</if>
				</if>
			</where>
		</if>
	</select>
	
	
	<!--根据ID获取详情  -->
	<select id="getById" resultType="HousesBuilding">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid AS "houses.id"	
		FROM 
			houses_building T 
		WHERE 
			id = #{id}
	</select>
	
	<update id="deleteById">
		UPDATE 
			houses_building 
		SET 
			deleted=1
		WHERE
			 id = #{id}
	</update>
	
	
	<update id="deleteSources">
		UPDATE 
			houses_source 
		SET 
			deleted=1
		WHERE 
			id IN 		
			<foreach collection="ids" item="item" index="index"  open="(" separator="," close=")">
				#{item}
			</foreach>
	</update>
	
	<select id="getSourceList" resultType="HousesSource">
		SELECT 
			<include refid="baseColumn"></include>
		FROM houses_source T
			<where>
				T.deleted !=1
				<if test="vo!=null">
					<if test="vo.model!=null">
						<if test="vo.model.housesBuilding.id!=null and vo.model.housesBuilding.id!=''">
							and T.buildingid = ${vo.model.housesBuilding.id}
						</if>
					</if>
				</if>
			</where>
	</select>
</mapper>