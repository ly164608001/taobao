<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lxhrainy.myjz.admin.houses.dao.IHousesDetailSalesinfoDao">
	<sql id="baseColumn">
		T.id,T.modifyuser,T.modifytime,T.allbuildingnum,T.allhouseholds,T.mindownpayment
	</sql>

	<select id="findListByPage" resultType="HousesDetailSalesinfo">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid AS "houses.id" 
		FROM 
			houses_detail_salesinfo T
		<if test="condition!=null">
			<where>
				T.deleted !=1
			</where>
			ORDER BY T.id DESC
			<include refid="Sql.pager" />
		</if>
	</select>
	
	<select id="getCountByCondition" resultType="int">
		SELECT 
			count(*)
		FROM 
			houses_detail_salesinfo T
		<if test="condition!=null">
			<where>
				T.deleted !=1
			</where>
		</if>
	</select>
	
	<select id="findAllList" resultType="HousesDetailSalesinfo">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid AS "houses.id" 
		FROM 
			houses_detail_salesinfo T
		<where>
			T.delete != 1
		</where>
	</select>
	

	<!--根据ID获取详情  -->
	<select id="getById" resultType="HousesDetailSalesinfo">
		SELECT 
			<include refid="baseColumn"></include>
			,T.housesid as "houses.id"
		FROM 
			houses_detail_salesinfo T
		WHERE 
			id = #{id}
	</select>
	
<!-- 根据ID删除楼盘信息 -->
	<update id="deleteById">
		UPDATE 
			houses_detail_salesinfo 
		SET 
			deleted=1
		WHERE 
			id = #{id}
	</update>
	
	<!-- 插入楼盘详细信息 -->
	<insert id="insert" >
		<!-- 配置Mysql主键自动增长 -->
		<selectKey resultType="int" keyProperty="id" order="BEFORE">
			SELECT 
				auto_increment AS id 
			FROM 
				information_schema.tables    
    		WHERE 
    			table_name='houses_detail_salesinfo'
		</selectKey>
		INSERT INTO 
			houses_detail_salesinfo (
				id,
				housesid,
		       	modifyuser,
		        modifytime, 
		        allbuildingnum,
		        allhouseholds,
		        mindownpayment
			)
		VALUES (
	    	#{id},
			#{houses.id},
	       	#{modifyuser},
	        #{modifytime}, 
	        #{allbuildingnum},
	        #{allhouseholds},
	        #{mindownpayment}
	      )
	</insert>
	
	<!-- 更新楼盘基本信息 -->
	<update id="update">
		UPDATE houses_detail_salesinfo 
		<set>
			<if test="houses != null and houses.id !=null and houses.id !=''">
				housesid = #{houses.id},
			</if>
			<if test="modifyuser !=null and modifyuser !=''">
				modifyuser = #{modifyuser},
			</if>
			<if test="modifytime !=null and modifytime !='' ">
				modifytime = #{modifytime},
			</if>
			<if test="allbuildingnum !=null and allbuildingnum !=''" >
				allbuildingnum = #{allbuildingnum},
			</if>
			<if test="allhouseholds !=null and allhouseholds !=''">
				allhouseholds = #{allhouseholds},
			</if>
			<if test="mindownpayment !=null and mindownpayment !=''" >
				mindownpayment = #{mindownpayment},
			</if>
		</set>
		WHERE 
			id = #{id}
	</update>
	
	<!--根据楼盘ID获取houses_detail_salesinfo详情  -->
	<select id="getSalesinfoByHousesId" resultType="HousesDetailSalesinfo">
		SELECT 
			<include refid="baseColumn"></include>
		FROM 
			houses_detail_salesinfo T
		WHERE 
			housesid = #{housesid}
	</select>	
</mapper>