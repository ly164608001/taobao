<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lxhrainy.myjz.admin.activity.dao.IActivityRushUserDao">
    
    
	
	<sql id="activityRushUserColumns">
		T.id AS "id",
		T.activityid AS "activityid",
		T.rushuserid AS "rushuserid.id",
		user.username AS "rushuserid.username",
		T.rushtime AS "rushtime",
		T.status AS "status",
		T.sourceid AS "sourceid.id",
		house.buildingid AS "sourceid.housesBuilding.id",
		house.floornum AS "sourceid.floornum",
		house.unit AS "sourceid.unit",
		house.roomnum AS "sourceid.roomnum",
		house.unitprice AS "sourceid.unitprice",
		house.totalprice AS "sourceid.totalprice",
		house.buildarea AS "sourceid.buildarea",
		type.name AS "housetype.name",
		type.roomnum AS "housetype.roomnum",
		type.toiletnum AS "housetype.toiletnum",
		type.hallnum AS "housetype.hallnum",
		type.balconynum AS "housetype.balconynum",
		T.usetime AS "usetime",
		T.rushprice AS "rushprice",
		T.deleted AS "deleted"
	</sql>
	
    
	<sql id="activityRushUserJoins">
	left JOIN user_info user ON user.id = T.rushuserid
	left JOIN houses_source house ON house.id = T.sourceid
	left JOIN houses_type type ON house.housetypeid=type.id
	</sql>
    
	<select id="getById" resultType="ActivityRushUser">
		SELECT 
			<include refid="activityRushUserColumns"/>
		FROM activity_rush_user T
		<include refid="activityRushUserJoins"/>
		WHERE T.id = #{id}
	</select>
	
	<select id="findListByPage" resultType="ActivityRushUser">
		SELECT 
			<include refid="activityRushUserColumns"/>
		FROM activity_rush_user  T
		<include refid="activityRushUserJoins"/>
		<if test="condition!=null">
			<where>
				T.deleted=0
				<if test="condition.model!=null">
					<if test="condition.model.activityid!=null and condition.model.activityid!=''">
						AND T.activityid = '${condition.model.activityid}'
					</if>
					<if test="condition.model.status!=null and condition.model.status!=''">
						AND T.status = '${condition.model.status}'
					</if>
				</if>
			</where>
			order by T.ID DESC
			<include refid="Sql.pager" />
		</if>
	</select>
	<select id="getCountByCondition" resultType="int">
		SELECT 
			count(*)
		FROM activity_rush_user  T
		<include refid="activityRushUserJoins"/>
		<if test="condition!=null">
			<where>
				T.deleted=0
				<if test="condition.model!=null">
					<if test="condition.model.activityid!=null and condition.model.activityid!=''">
						AND T.activityid = '${condition.model.activityid}'
					</if>
					<if test="condition.model.status!=null and condition.model.status!=''">
						AND T.status = '${condition.model.status}'
					</if>
					
				</if>
			</where>
		</if>
	</select>
	
	<select id="findAllList" resultType="ActivityRushUser">
		SELECT 
			<include refid="activityRushUserColumns"/>
		FROM activity_rush_user  T
		<include refid="activityRushUserJoins"/>
		<where>
			T.deleted=0
			<if test="condition!=null">
				<if test="condition.model!=null">
					<if test="condition.model.activityid!=null and condition.model.activityid!=''">
						AND T.activityid = '${condition.model.activityid}'
					</if>
					<if test="condition.model.status!=null and condition.model.status!=''">
						AND T.status = '${condition.model.status}'
					</if>
				</if>
			</if>
		</where>		
	</select>
	
	<insert id="insert">
	INSERT INTO activity_rush (
	id,
	activityid,
	rushuserid,
	rushtime,
	status,
	sourceid,
	usetime,
	rushprice,
	deleted
	)
	values (
	#{id},
	#{activityid},
	#{rushuserid.id},
	#{rushtime},
	#{status},
	#{sourceid.id},
	#{usetime},
	#{rushprice},
	#{deleted}
	)
		<!-- 配置Mysql主键自动增长 -->
		<selectKey resultType="int" keyProperty="id">
			select
			LAST_INSERT_ID() as value  
		</selectKey>
	</insert>
		
	 <update id="update" >
    update activity_rush_user
    <set >
     <if test="activityid != null" >
        activityid = #{activityid},
      </if>
      <if test="rushuserid != null" >
        rushuserid = #{rushuserid.id},
      </if>
      <if test="rushtime != null" >
        rushtime = #{rushtime},
      </if>
      <if test="status != null" >
        status = #{status},
      </if>
      <if test="sourceid != null" >
        sourceid = #{sourceid.id},
      </if>
      <if test="usetime != null" >
        usetime = #{usetime},
      </if>
      <if test="rushprice != null" >
        rushprice = #{rushprice},
      </if>
      <if test="deleted != null" >
        deleted = #{deleted},
      </if>
    </set>
    where id = #{id}
  </update>
	
	<update id="deleteById">
		update activity_rush_user set 
			deleted=1
		WHERE id = #{id}
	</update>
	
</mapper>