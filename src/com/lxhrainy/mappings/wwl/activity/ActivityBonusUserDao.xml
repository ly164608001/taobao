<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lxhrainy.myjz.admin.activity.dao.IActivityBonusUserDao">
    
    <resultMap id="ActivityBonusUser" type="com.lxhrainy.myjz.admin.activity.model.ActivityBonusUser">
		<id property="id" column="id" />
		<result column="user.id" property="user.id"/>
		<result column="user.username" property="user.username"/>
	    <result column="activityid" property="activityid" />
	    <result column="gettime" property="gettime" />
	    <result column="status" property="status" />
	    <result column="usetime" property="usetime" />
	    <result column="orderid" property="orderid" />
	</resultMap>
	
	<sql id="activityBonusUserColumns">
		T.id AS "id",
		T.userid AS "user.id",
		T.activityid AS "activityid",
		T.gettime AS "gettime",
		T.status AS "status",
		T.usetime AS "usetime",
		T.orderid AS "orderid",
		user.username AS "user.username"
	</sql>
	
    
	<sql id="activityBonusUserJoins">
	JOIN user_info user ON user.id = T.userid
	</sql>
    
	<select id="getById" resultType="ActivityBonusUser">
		SELECT 
			<include refid="activityBonusUserColumns"/>
		FROM activity_bonus_user T
		<include refid="activityBonusUserJoins"/>
		WHERE T.id = #{id}
	</select>
	
	<select id="findListByPage" resultMap="ActivityBonusUser">
		SELECT 
			<include refid="activityBonusUserColumns"/>
		FROM activity_bonus_user T
		<include refid="activityBonusUserJoins"/>
		<if test="condition!=null">
			<where>
				<if test="condition.model!=null">
					<if test="condition.model.activityid!=null and condition.model.activityid!=''">
						T.activityid='${condition.model.activityid}'
					</if>
					<if test="condition.model.status!=null and condition.model.status!=''">
						AND T.status = '${condition.model.status}'
					</if>
				</if>
			</where>
			order by T.ID DESC
			<include refid="Sql.pager" />
		</if>
	</select>
	<select id="getCountByCondition" resultType="int">
		SELECT 
			count(*)
		FROM activity_bonus_user T
		<include refid="activityBonusUserJoins"/>
		<if test="condition!=null">
			<where>
				<if test="condition.model!=null">
					<if test="condition.model.activityid!=null and condition.model.activityid!=''">
						T.activityid='${condition.model.activityid}'
					</if>
					<if test="condition.model.status!=null and condition.model.status!=''">
						AND T.status = '${condition.model.status}'
					</if>
				</if>
			</where>
		</if>
	</select>
	
	<select id="findAllList" resultType="ActivityBonusUser">
		SELECT 
			<include refid="activityBonusUserColumns"/>
		FROM activity_bonus_user T
		<include refid="activityBonusUserJoins"/>
		<where>
			<if test="condition!=null">
				<if test="condition.model!=null">
					<if test="condition.model.status!=null and condition.model.status!=''">
						T.status = '${condition.model.status}'
					</if>
				</if>
			</if>
		</where>		
	</select>
	
	<insert id="insert">
		INSERT INTO activity_bonus_user (
		id,
		userid, 
		activityid, 
		gettime, 
      	status,
       	usetime,
       	orderid 
     	)VALUES  (
     	#{id},
     	#{user.id},
     	#{activityid}, 
      	#{gettime},
       	#{status},
        #{usetime}, 
      	#{orderid}
      )
		<!-- 配置Mysql主键自动增长 -->
		<selectKey resultType="int" keyProperty="id">
			select
			LAST_INSERT_ID() as value  
		</selectKey>
	</insert>
		
	 <update id="update" >
    update activity_bonus_user
    <set >
      <if test="user != null" >
        userid = #{user.id},
      </if>
      <if test="activityid != null" >
        activityid = #{activityid},
      </if>
      <if test="gettime != null" >
        gettime = #{gettime},
      </if>
      <if test="status != null" >
        status = #{status},
      </if>
      <if test="usetime != null" >
        usetime = #{usetime},
      </if>
      <if test="orderid != null" >
        orderid = #{orderid}
      </if>
    </set>
    where id = #{id}
  </update>		
  
  <select id="countByUserId" resultType="int">
  	SELECT 
  		count(*) 
  	FROM activity_bonus_user T
  	where T.userid = #{userid} 
  	<if test="status != null">
  		and T.status = #{status}
  	</if>
  </select>
</mapper>