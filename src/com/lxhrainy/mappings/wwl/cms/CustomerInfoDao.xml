<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lxhrainy.myjz.admin.cms.dao.ICustomerInfoDao">
    
	
	<sql id="customerInfoColumns">
		T.id AS "id",
		T.username AS "username",
		T.phone AS "phone",
		T.operatorid AS "operator.id",
		T.createtime AS "createtime",
		T.userno AS "userno",
		T.sex AS "sex",
		T.step AS "step",
		T.source AS "source",
		T.address AS "address",
		T.memo AS "memo",
		user.username AS "operator.username"
	</sql>
	
    
	<sql id="customerInfoJoins">
	JOIN user_info user ON user.id = T.operatorid
	</sql>
    
	<select id="getById" resultType="CustomerInfo">
		SELECT 
			<include refid="customerInfoColumns"/>
		FROM customer_info T
		<include refid="customerInfoJoins"/>
		WHERE T.id = #{id}
	</select>
	
	<select id="findListByPage" resultType="CustomerInfo">
		SELECT 
			<include refid="customerInfoColumns"/>
		FROM customer_info T
		<include refid="customerInfoJoins"/>
		<if test="condition!=null">
			<where>
				<if test="condition.model!=null">
					<if test="condition.model.username!=null and condition.model.username!=''">
						T.username LIKE '${condition.model.username}%'
					</if>
				</if>
			</where>
			order by T.ID DESC
			<include refid="Sql.pager" />
		</if>
	</select>
	<select id="getCountByCondition" resultType="int">
		SELECT 
			count(*)
		FROM customer_info T
		<include refid="customerInfoJoins"/>
		<if test="condition!=null">
			<where>
				<if test="condition.model!=null">
					<if test="condition.model.username!=null and condition.model.username!=''">
						T.username LIKE '${condition.model.username}%'
					</if>
				</if>
			</where>
		</if>
	</select>
	
	<select id="findAllList" resultType="CustomerInfo">
		SELECT 
			<include refid="customerInfoColumns"/>
		FROM customer_info T
		<include refid="customerInfoJoins"/>
		<where>
			<if test="condition!=null">
				<if test="condition.model!=null">
					<if test="condition.model.username!=null and condition.model.username!=''">
						T.username LIKE '${condition.model.username}%'
					</if>
				</if>
			</if>
		</where>		
	</select>
	
	<insert id="insert">
		INSERT INTO customer_info(
			username,
			phone,
			operatorid,
			createtime,
			userno,
			sex,
			step,
			source,
			address,
			memo
		) VALUES (
			#{username},
			#{phone},
			#{operatorid},
			#{createtime},
			#{userno},
			#{sex},
			#{step},
			#{source},
			#{address},
			#{memo}
		)
		<!-- 配置Mysql主键自动增长 -->
		<selectKey resultType="int" keyProperty="id">
			select
			LAST_INSERT_ID() as value  
		</selectKey>
	</insert>
	
	<update id="update">
		UPDATE customer_info
		<set>
			<if test="username!=null">
				username = #{username},
			</if>
			<if test="phone != null">
				phone = #{phone},
			</if>
			<if test="operator != null and operator.id != null">
				operatorid = #{operator.id},
			</if>
			<if test="createtime != null">
				createtime = #{createtime},
			</if>
			<if test="userno != null">
				userno = #{userno},
			</if>
			<if test="sex != null">
				sex = #{sex},
			</if>
			<if test="step != null">
				step = #{step},
			</if>
			<if test="source != null">
				source = #{source},
			</if>
			<if test="address != null">
				address = #{address},
			</if>
			<if test="memo != null">
				memo = #{memo},
			</if>
		</set>
		WHERE id = #{id}
	</update>
	
	<update id="deleteById">
		update customer_info set 
			deleted=1
		WHERE id = #{id}
	</update>
	
</mapper>